(function(c,d){if(!d){throw new Error("Filterizr requires jQuery to work.")}var e=function(f){this.init(f)};e.prototype={init:function(f){this.root={x:0,y:0,w:f}},fit:function(k){var l,i,j,f=k.length;var g=f>0?k[0].h:0;this.root.h=g;for(l=0;l<f;l++){j=k[l];if((i=this.findNode(this.root,j.w,j.h))){j.fit=this.splitNode(i,j.w,j.h)}else{j.fit=this.growDown(j.w,j.h)}}},findNode:function(g,f,i){if(g.used){return this.findNode(g.right,f,i)||this.findNode(g.down,f,i)}else{if((f<=g.w)&&(i<=g.h)){return g}else{return null}}},splitNode:function(i,f,g){i.used=true;i.down={x:i.x,y:i.y+g,w:i.w,h:i.h-g};i.right={x:i.x+f,y:i.y,w:i.w-f,h:g};return i},growDown:function(f,g){var i;this.root={used:true,x:0,y:0,w:this.root.w,h:this.root.h+g,down:{x:0,y:this.root.h,w:this.root.w,h:g},right:this.root};if((i=this.findNode(this.root,f,g))){return this.splitNode(i,f,g)}else{return null}}};d.fn.filterizr=function(){var f=this,g=arguments;if(!f._fltr){f._fltr=d.fn.filterizr.prototype.init(f.selector,(typeof g[0]==="object"?g[0]:undefined))}if(typeof g[0]==="string"){if(g[0].lastIndexOf("_")>-1){throw new Error("Filterizr error: You cannot call private methods")}if(typeof f._fltr[g[0]]==="function"){f._fltr[g[0]](g[1],g[2])}else{throw new Error("Filterizr error: There is no such function")}}return f};d.fn.filterizr.prototype={init:function(f,h){var g=d(f).extend(d.fn.filterizr.prototype);g.options={animationDuration:0.5,callbacks:{onFilteringStart:function(){},onFilteringEnd:function(){},onShufflingStart:function(){},onShufflingEnd:function(){},onSortingStart:function(){},onSortingEnd:function(){}},delay:0,delayMode:"progressive",easing:"ease-out",filter:"all",filterOutCss:{opacity:0,transform:"scale(0.5)"},filterInCss:{opacity:1,transform:"scale(1)"},layout:"sameSize",pageSize:null,selector:(typeof f==="string")?f:".filtr-container",setupControls:true};if(arguments.length===0){f=g.options.selector;h=g.options}if(arguments.length===1&&typeof arguments[0]==="object"){h=arguments[0]}if(h){g.setOptions(h)}g.css({padding:0,position:"relative"});g._lastCategory=0;g._isAnimating=false;g._isShuffling=false;g._isSorting=false;g._mainArray=g._getFiltrItems();g._subArrays=g._makeSubarrays();g._activeArray=g._getCollectionByFilter(g.options.filter);g._toggledCategories={};g._typedText=d("input[data-search]").val()||"";g._uID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(k){var j=Math.random()*16|0,i=k=="x"?j:(j&3|8);return i.toString(16)});g._setupEvents();if(g.options.setupControls){g._setupControls()}g.filter(g.options.filter);return g},filter:function(g){var f=this,h=f._getCollectionByFilter(g);f.options.filter=g;f.trigger("filteringStart");f._handleFiltering(h);if(f._isSearchActivated()){f.search(f._typedText)}},toggleFilter:function(f){var g=this,j=[],h=0;g.trigger("filteringStart");if(f){if(!g._toggledCategories[f]){g._toggledCategories[f]=true}else{delete g._toggledCategories[f]}}if(g._multifilterModeOn()){j=g._makeMultifilterArray();g._handleFiltering(j);if(g._isSearchActivated()){g.search(g._typedText)}}else{g.filter("all");if(g._isSearchActivated()){g.search(g._typedText)}}},search:function(k){var f=this,l=f._multifilterModeOn()?f._makeMultifilterArray():f._getCollectionByFilter(f.options.filter),h=[],g=0;if(f._isSearchActivated()){for(g=0;g<l.length;g++){var j=l[g].text().toLowerCase().indexOf(k.toLowerCase())>-1;if(j){h.push(l[g])}}}if(h.length>0){f._handleFiltering(h)}else{if(f._isSearchActivated()){for(g=0;g<f._activeArray.length;g++){f._activeArray[g]._filterOut()}}else{f._handleFiltering(l)}}},shuffle:function(){var f=this;f._isAnimating=true;f._isShuffling=true;f.trigger("shufflingStart");f._mainArray=f._fisherYatesShuffle(f._mainArray);f._subArrays=f._makeSubarrays();var g=f._multifilterModeOn()?f._makeMultifilterArray():f._getCollectionByFilter(f.options.filter);if(f._isSearchActivated()){f.search(f._typedText)}else{f._placeItems(g)}},sort:function(f,k){var h=this;f=f||"domIndex";k=k||"asc";h._isAnimating=true;h._isSorting=true;h.trigger("sortingStart");var g=f!=="domIndex"&&f!=="sortData"&&f!=="w"&&f!=="h";if(g){for(var j=0;j<h._mainArray.length;j++){h._mainArray[j][f]=h._mainArray[j].data(f)}}h._mainArray.sort(h._comparator(f,k));h._subArrays=h._makeSubarrays();var l=h._multifilterModeOn()?h._makeMultifilterArray():h._getCollectionByFilter(h.options.filter);if(h._isSearchActivated()){h.search(h._typedText)}else{h._placeItems(l)}},setOptions:function(g){var f=this,h=0;for(var j in g){f.options[j]=g[j]}if(f._mainArray&&(g.animationDuration||g.delay||g.easing||g.delayMode)){for(h=0;h<f._mainArray.length;h++){f._mainArray[h].css("transition","all "+f.options.animationDuration+"s "+f.options.easing+" "+f._mainArray[h]._calcDelay()+"ms")}}if(g.callbacks){if(!g.callbacks.onFilteringStart){f.options.callbacks.onFilteringStart=function(){}}if(!g.callbacks.onFilteringEnd){f.options.callbacks.onFilteringEnd=function(){}}if(!g.callbacks.onShufflingStart){f.options.callbacks.onShufflingStart=function(){}}if(!g.callbacks.onShufflingEnd){f.options.callbacks.onShufflingEnd=function(){}}if(!g.callbacks.onSortingStart){f.options.callbacks.onSortingStart=function(){}}if(!g.callbacks.onSortingEnd){f.options.callbacks.onSortingEnd=function(){}}}if(!f.options.filterInCss.transform){f.options.filterInCss.transform="translate3d(0,0,0)"}if(!f.options.filterOutCss.transform){f.options.filterOutCss.transform="translate3d(0,0,0)"}},_getFiltrItems:function(){var f=this,h=d(f.find(".filtr-item")),g=[];d.each(h,function(j,l){var k=d(l).extend(a)._init(j,f);g.push(k)});return g},_makeSubarrays:function(){var g=this,k=[];for(var j=0;j<g._lastCategory;j++){k.push([])}for(j=0;j<g._mainArray.length;j++){if(typeof g._mainArray[j]._category==="object"){var l=g._mainArray[j]._category.length;for(var f=0;f<l;f++){var h=g._mainArray[j]._category[f]-1;if(!g.options.pageSize||(k[h].length<g.options.pageSize)){k[h].push(g._mainArray[j])}}}else{k[g._mainArray[j]._category-1].push(g._mainArray[j])}}return k},_makeMultifilterArray:function(){var g=this,n=[],m={};for(var h=0;h<g._mainArray.length;h++){var l=g._mainArray[h],j=false,k=l.domIndex in m===false;if(Array.isArray(l._category)){for(var f=0;f<l._category.length;f++){if(l._category[f] in g._toggledCategories){j=true;break}}}else{if(l._category in g._toggledCategories){j=true}}if(k&&j){m[l.domIndex]=true;n.push(l)}}return n},_setupControls:function(){var f=this;d("*[data-filter]").click(function(){var g=d(this).data("filter");if(f.options.filter===g){return}f.filter(g)});d("*[data-multifilter]").click(function(){var g=d(this).data("multifilter");if(g==="all"){f._toggledCategories={};f.filter("all")}else{f.toggleFilter(g)}});d("*[data-shuffle]").click(function(){f.shuffle()});d("*[data-sortAsc]").click(function(){var g=d("*[data-sortOrder]").val();f.sort(g,"asc")});d("*[data-sortDesc]").click(function(){var g=d("*[data-sortOrder]").val();f.sort(g,"desc")});d("input[data-search]").keyup(function(){f._typedText=d(this).val();f._delayEvent(function(){f.search(f._typedText)},250,f._uID)})},_setupEvents:function(){var f=this;d(c).resize(function(){f._delayEvent(function(){f.trigger("resizeFiltrContainer")},250,f._uID)});f.on("resizeFiltrContainer",function(){if(f._multifilterModeOn()){f.toggleFilter()}else{f.filter(f.options.filter)}}).on("filteringStart",function(){f.options.callbacks.onFilteringStart()}).on("filteringEnd",function(){f.options.callbacks.onFilteringEnd()}).on("shufflingStart",function(){f._isShuffling=true;f.options.callbacks.onShufflingStart()}).on("shufflingEnd",function(){f.options.callbacks.onShufflingEnd();f._isShuffling=false}).on("sortingStart",function(){f._isSorting=true;f.options.callbacks.onSortingStart()}).on("sortingEnd",function(){f.options.callbacks.onSortingEnd();f._isSorting=false})},_calcItemPositions:function(){var t=this,k=t._activeArray,r=0,p=Math.round(t.width()/t.find(".filtr-item").outerWidth()),m=0,g=Array.isArray(k)&&k.length?k[0].outerWidth():0,v=0,h=0,s=0,y=0,w=0,n=0,A=[];if(t.options.layout==="packed"){d.each(t._activeArray,function(l,x){x._updateDimensions()});var q=new e(t.outerWidth());q.fit(t._activeArray);for(y=0,w=Array.isArray(k)?k.length:0;y<w;y++){A.push({left:k[y].fit.x,top:k[y].fit.y})}r=q.root.h}if(t.options.layout==="horizontal"){m=1;for(y=1,w=Array.isArray(k)?k.length:0;y<=w;y++){g=k[y-1].outerWidth();v=k[y-1].outerHeight();A.push({left:h,top:s});h+=g;if(r<v){r=v}}}else{if(t.options.layout==="vertical"){for(y=1,w=Array.isArray(k)?k.length:0;y<=w;y++){v=k[y-1].outerHeight();A.push({left:h,top:s});s+=v}r=s}else{if(t.options.layout==="sameHeight"){m=1;var z=t.outerWidth();for(y=1,w=Array.isArray(k)?k.length:0;y<=w;y++){g=k[y-1].width();var o=k[y-1].outerWidth(),f=0;if(k[y]){f=k[y].width()}A.push({left:h,top:s});n=h+g+f;if(n>z){n=0;h=0;s+=Array.isArray(k)&&k.length?k[0].outerHeight():0;m++}else{h+=o}}r=m*k[0].outerHeight()}else{if(t.options.layout==="sameWidth"){for(y=1,w=Array.isArray(k)?k.length:0;y<=w;y++){A.push({left:h,top:s});if(y%p===0){m++}h+=g;s=0;if(m>0){n=m;while(n>0){s+=k[y-(p*n)].outerHeight();n--}}if(y%p===0){h=0}}for(y=0;y<p;y++){var u=0,j=y;while(k[j]){u+=k[j].outerHeight();j+=p}if(u>r){r=u;u=0}else{u=0}}}else{if(t.options.layout==="sameSize"){for(y=1,w=Array.isArray(k)?k.length:0;y<=w;y++){A.push({left:h,top:s});h+=g;if(y%p===0){s+=k[0].outerHeight();h=0}}m=Array.isArray(k)?Math.ceil(k.length/p):0;r=m*(Array.isArray(k)&&k.length?k[0].outerHeight():0)}}}}}t.css("height",r);return A},_handleFiltering:function(k){var g=this,j=g._getArrayOfUniqueItems(g._activeArray,k);for(var h=0,f=Array.isArray(j)?j.length:0;h<f;h++){j[h]._filterOut()}g._activeArray=k;g._placeItems(k)},_multifilterModeOn:function(){var f=this;return Object.keys(f._toggledCategories).length>0},_isSearchActivated:function(){var f=this;return f._typedText.length>0},_placeItems:function(f){var h=this;h._isAnimating=true;h._itemPositions=h._calcItemPositions();for(var j=0,g=Array.isArray(f)?f.length:0;j<g;j++){f[j]._filterIn(h._itemPositions[j])}},_getCollectionByFilter:function(g){var f=this;return g==="all"?f._mainArray:f._subArrays[g-1]},_makeDeepCopy:function(h){var f={};for(var g in h){f[g]=h[g]}return f},_comparator:function(g,f){return function(i,h){if(f==="asc"){if(i[g]<h[g]){return -1}else{if(i[g]>h[g]){return 1}else{return 0}}}else{if(f==="desc"){if(h[g]<i[g]){return -1}else{if(h[g]>i[g]){return 1}else{return 0}}}}}},_getArrayOfUniqueItems:function(j,h){var m=[],n={},f=Array.isArray(h)?h.length:0,k,g;for(k=0;k<f;k++){n[h[k].domIndex]=true}f=Array.isArray(j)?j.length:0;for(k=0;k<f;k++){g=j[k];if(!(g.domIndex in n)){m.push(g)}}return m},_delayEvent:(function(){var f=this,g={};return function(j,h,i){if(i===null){throw Error("UniqueID needed")}if(g[i]){clearTimeout(g[i])}g[i]=setTimeout(j,h)}})(),_fisherYatesShuffle:function b(j){var f=j.length,h,g;while(f){g=Math.floor(Math.random()*f--);h=j[f];j[f]=j[g];j[g]=h}return j}};var a={_init:function(h,i){var f=this,g=0;f._parent=i;f._category=f._getCategory();f._lastPos={};f.domIndex=h;f.sortData=f.data("sort");f.w=0;f.h=0;f._isFilteredOut=true;f._filteringOut=false;f._filteringIn=false;f.css(i.options.filterOutCss).css({"-webkit-backface-visibility":"hidden",perspective:"1000px","-webkit-perspective":"1000px","-webkit-transform-style":"preserve-3d",position:"absolute",transition:"all "+i.options.animationDuration+"s "+i.options.easing+" "+f._calcDelay()+"ms"});f.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){f._onTransitionEnd()});return f},_updateDimensions:function(){var f=this;f.w=f.outerWidth();f.h=f.outerHeight()},_calcDelay:function(){var f=this,g=0;if(f._parent.options.delayMode==="progressive"){g=f._parent.options.delay*f.domIndex}else{if(f.domIndex%2===0){g=f._parent.options.delay}}return g},_getCategory:function(){var f=this,g=f.data("category");if(typeof g==="string"){g=g.split(", ");for(var h=0;h<g.length;h++){if(isNaN(parseInt(g[h]))){throw new Error("Filterizr: the value of data-category must be a number, starting from value 1 and increasing.")}if(parseInt(g[h])>f._parent._lastCategory){f._parent._lastCategory=parseInt(g[h])}}}else{if(g>f._parent._lastCategory){f._parent._lastCategory=g}}return g},_onTransitionEnd:function(){var f=this;if(f._filteringOut){d(f).addClass("filteredOut");f._isFilteredOut=true;f._filteringOut=false}else{if(f._filteringIn){f._isFilteredOut=false;f._filteringIn=false}}if(f._parent._isAnimating){if(f._parent._isShuffling){f._parent.trigger("shufflingEnd")}else{if(f._parent._isSorting){f._parent.trigger("sortingEnd")}else{f._parent.trigger("filteringEnd")}}f._parent._isAnimating=false}},_filterOut:function(){var f=this,g=f._parent._makeDeepCopy(f._parent.options.filterOutCss);g.transform+=" translate3d("+f._lastPos.left+"px,"+f._lastPos.top+"px, 0)";f.css(g);f.css("pointer-events","none");f._filteringOut=true},_filterIn:function(h){var f=this,g=f._parent._makeDeepCopy(f._parent.options.filterInCss);d(f).removeClass("filteredOut");f._filteringIn=true;f._lastPos=h;f.css("pointer-events","auto");g.transform+=" translate3d("+h.left+"px,"+h.top+"px, 0)";f.css(g)}}})(this,jQuery);